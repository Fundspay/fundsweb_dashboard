<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="keyword" content="" />
    <meta name="author" content="WRAPCODERS" />
    <!--! The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags !-->
    <!--! BEGIN: Apps Title-->
    <title>Fundsroom || Dashboard</title>
    <!--! END:  Apps Title-->
    <!--! BEGIN: Favicon-->
    <link rel="shortcut icon" type="image/x-icon" href="./../assets/images/FundsAuditLogo.png" />
    <!--! END: Favicon-->
    <!--! BEGIN: Bootstrap CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/bootstrap.min.css" />
    <!--! END: Bootstrap CSS-->
    <!--! BEGIN: Vendors CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/daterangepicker.min.css" />
    <!--! END: Vendors CSS-->
    <!--! BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css" />
    <!--! END: Custom CSS-->
    <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
    <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
    <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Navigation Manu !-->
    <!--! ================================================================ !-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <nav class="nxl-navigation">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="index.html" class="b-brand">
                    <img src="/assets/img/logo/Fundsweb1.png" alt="" class="logo logo-lg" />
                    <img src="./../assets/images/FundsAuditLogo.png" alt="" class="logo logo-sm" />
                </a>
            </div>
            <div class="navbar-content">
                <ul class="nxl-navbar">
                    <li class="nxl-item nxl-caption">
                        <label>Navigation</label>
                    </li>
                    <li class="nxl-item nxl-hasmenu">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-airplay"></i></span>
                            <span class="nxl-mtext">Dashboard</span><span class="nxl-arrow"><i
                                    class="feather-chevron-right"></i></span>
                        </a>
                        <ul class="nxl-submenu">
                            <li class="nxl-item"><a class="nxl-link" href="index.html">Onboarding Details</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="payment-details.html">Payment Details</a>
                            </li>
                            <li class="nxl-item"><a class="nxl-link" href="website-creation-details.html">Website
                                    Creation Details</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="user-track.html">User Status Tracking</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nxl-item nxl-hasmenu">
                        <a href="/admin/my-websites.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-user"></i></span>
                            <span class="nxl-mtext">My-websites</span><span class="nxl-arrow"><i
                                    class="feather-chevron-right"></i></span>
                        </a>
                    </li>
                    <!-- Admin Page Link (Hidden by Default) -->
                    <!-- <li class="nxl-item nxl-hasmenu" id="adminPageLink" style="display: none;">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-settings"></i></span>
                            <span class="nxl-mtext">Admin Page</span><span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>
                        <ul class="nxl-submenu">
                            <li class="nxl-item"><a class="nxl-link" href="admin.html">Dashboard Analysis - Edit</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="business-analysis-edit.html">Business Analysis - Edit</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="analysis-edit.html">Performance Analysis - Edit</a></li>
                        </ul>
                    </li> -->
                </ul>

                <div class="card text-center">
                    <div class="card-body">
                        <i class="feather-briefcase fs-4 text-dark"></i>
                        <h6 class="mt-4 text-dark fw-bolder">Welcome to FundsRoom</h6>
                        <p class="fs-11 my-3 text-dark">
                            FundsRoom is your trusted financial partner, offering seamless solutions for managing
                            investments, loans, and business funds with ease.
                        </p>
                        <!-- <a href="https://www.fundsroom.com/" class="btn btn-primary text-dark w-100" style="margin-bottom: 10%;">Fundsroom</a>
                        <a href="https://play.google.com/store/apps/details?id=com.fundsroom.fundsaudit&hl=en_IN" class="btn btn-success text-light w-100">Download FundsAudit</a> -->
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!--! ================================================================ !-->
    <!--! [End]  Navigation Manu !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Header !-->
    <!--! ================================================================ !-->
    <header class="nxl-header">
        <div class="header-wrapper">
            <!--! [Start] Header Left !-->
            <div class="header-left d-flex align-items-center gap-4">
                <!--! [Start] nxl-head-mobile-toggler !-->
                <a href="javascript:void(0);" class="nxl-head-mobile-toggler" id="mobile-collapse">
                    <div class="hamburger hamburger--arrowturn">
                        <div class="hamburger-box">
                            <div class="hamburger-inner"></div>
                        </div>
                    </div>
                </a>
                <!--! [Start] nxl-head-mobile-toggler !-->
                <!--! [Start] nxl-navigation-toggle !-->
                <div class="nxl-navigation-toggle">
                    <a href="javascript:void(0);" id="menu-mini-button">
                        <i class="feather-align-left"></i>
                    </a>
                    <a href="javascript:void(0);" id="menu-expend-button" style="display: none">
                        <i class="feather-arrow-right"></i>
                    </a>
                </div>
                <!--! [End] nxl-navigation-toggle !-->
                <!--! [Start] nxl-lavel-mega-menu-toggle !-->
                <!-- <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
                    <a href="javascript:void(0);" id="nxl-lavel-mega-menu-open">
                        <i class="feather-align-left"></i>
                    </a>
                </div> -->
                <!--! [End] nxl-lavel-mega-menu-toggle !-->
                <!--! [Start] nxl-lavel-mega-menu !-->
                <div class="nxl-drp-link nxl-lavel-mega-menu">
                    <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
                        <a href="javascript:void(0)" id="nxl-lavel-mega-menu-hide">
                            <i class="feather-arrow-left me-2"></i>
                            <span>Back</span>
                        </a>
                    </div>

                    <!--! [End] nxl-lavel-mega-menu-wrapper !-->
                </div>
                <!--! [End] nxl-lavel-mega-menu !-->
            </div>
            <!--! [End] Header Left !-->
            <!--! [Start] Header Right !-->
            <div class="header-right ms-auto">
                <div class="d-flex align-items-center">

                    <!-- Full Screen Switcher -->
                    <div class="nxl-h-item d-none d-sm-flex">
                        <div class="full-screen-switcher">
                            <a href="javascript:void(0);" class="nxl-head-link me-0"
                                onclick="$('body').fullScreenHelper('toggle');">
                                <i class="feather-maximize maximize"></i>
                                <i class="feather-minimize minimize"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Dark/Light Theme Toggle -->
                    <div class="nxl-h-item dark-light-theme">
                        <a href="javascript:void(0);" class="nxl-head-link me-0 dark-button">
                            <i class="feather-moon"></i>
                        </a>
                        <a href="javascript:void(0);" class="nxl-head-link me-0 light-button" style="display: none">
                            <i class="feather-sun"></i>
                        </a>
                    </div>

                    <!-- Logout Button -->
                    <div class="nxl-h-item">
                        <a href="javascript:void(0);" class="nxl-head-link me-0" id="logout-button" title="Logout">
                            <i class="feather-log-out"></i>
                        </a>
                    </div>

                    <!-- User Dropdown -->
                    <div class="dropdown nxl-h-item">
                        <a href="javascript:void(0);" data-bs-toggle="dropdown" role="button"
                            data-bs-auto-close="outside">
                            <div class="avatar-text avatar-lg bg-gray-200">
                                <i class="feather-user"></i>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-user-dropdown">
                            <div class="dropdown-header">
                                <section id="user-header">
                                    <div id="user-section" class="user-dropdown">Fundsweb Admin</div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--! [End] Header Right !-->
        </div>
    </header>
    <!--! ================================================================ !-->
    <!--! [End] Header !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container">
        <div class="nxl-content">
            <!-- [ page-header ] start -->
            <div class="page-header">
                <div class="page-header-left d-flex align-items-center">
                    <div class="page-header-title">
                        <h5 class="m-b-10">Dashboard</h5>
                    </div>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item">Onboarding Details</li>
                    </ul>
                </div>

            </div>
            <!-- [ page-header ] end -->
            <!-- [ Main Content ] start -->
            <div class="main-content">
                <div class="row">
                    <!-- [Latest Leads] start -->
                    <div class="col-12">
                        <div class="card stretch stretch-full">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title">Onboarding Details</h5>
                                </div>
                                <div class="card-header-action">
                                    <!-- <div data-bs-toggle="tooltip" title="Delete">
                                            <a href="javascript:void(0);" class="avatar-text avatar-xs bg-danger" data-bs-toggle="remove"> </a>
                                        </div> -->
                                    <div data-bs-toggle="tooltip" title="Refresh">
                                        <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning"
                                            data-bs-toggle="refresh"> </a>
                                    </div>
                                    <div data-bs-toggle="tooltip" title="Maximize/Minimize">
                                        <a href="javascript:void(0);" class="avatar-text avatar-xs bg-success"
                                            data-bs-toggle="expand"> </a>
                                    </div>
                                    <div class="search-bar">
                                        <input type="text" id="searchInput" class="form-control" placeholder="Search..."
                                            oninput="filterTable()">
                                    </div>
                                </div>
                            </div>
                            <div class="card-body custom-card-action p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="leadsTable">
                                        <thead>
                                            <tr class="border-b">
                                                <th scope="row">S No.</th>
                                                <th>Name</th>
                                                <th>Mobile No.</th>
                                                <th>Email</th>
                                                <th>Date of Payment</th>
                                                <th>GST No.</th>
                                                <th>Address</th>
                                                <th>City</th>
                                                <th>Status of Payment</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Rows will be dynamically populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <ul class="list-unstyled d-flex align-items-center gap-2 mb-0 pagination-common-style"
                                        id="pagination">
                                        <!-- Pagination links will be dynamically populated here -->
                                    </ul>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" onclick="printTable()">
                                            <i class="bi bi-printer"></i> Print
                                        </button>
                                        <button class="btn btn-success" onclick="exportToExcel()">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ Main Content ] end -->
        </div>
        <!-- [ Footer ] start -->
        <footer class="footer">
            <p class="fs-11 text-muted fw-medium text-uppercase mb-0 copyright">
                <span>Copyright Fundsroom Â©</span>
                <script>
                    document.write(new Date().getFullYear());
                </script>
            </p>
            <div class="d-flex align-items-center gap-4">
                <!-- <a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Help</a>
					<a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Terms</a>
					<a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Privacy</a> -->
            </div>
        </footer>
        <!-- [ Footer ] end -->
    </main>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->

    <!--! ================================================================ !-->
    <!--! Footer Script !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Vendors JS !-->
    <script src="./../assets/vendors/js/vendors.min.js"></script>
    <!-- vendors.min.js {always must need to be top} -->
    <script src="./../assets/vendors/js/daterangepicker.min.js"></script>
    <script src="./../assets/vendors/js/apexcharts.min.js"></script>
    <script src="./../assets/vendors/js/circle-progress.min.js"></script>
    <script src="./../assets/vendors/js/jquery.calendar.min.js"></script>
    <!--! END: Vendors JS !-->
    <!--! BEGIN: Apps Init  !-->
    <script src="./../assets/js/common-init.min.js"></script>
    <!-- <script src="./../assets/js/dashboard-init.min.js"></script> -->
    <!-- <script src="./../assets/js/reports-project-init.min.js"></script> -->
    <!-- <script src="./../assets/js/widgets-miscellaneous-init.min.js"></script> -->
    <!--! END: Apps Init !-->
    <!--! BEGIN: Theme Customizer  !-->
    <script src="./../assets/js/theme-customizer-init.min.js"></script>
    <!--! END: Theme Customizer !-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include SweetAlert2 (only if not already included) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script>
        var admin = sessionStorage.getItem("admin");
        console.log("Admin status:", admin);

        window.addEventListener('pageshow', function (event) {
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
                window.location.reload();
            }
        });

        window.onload = function () {

            if (admin !== 'true') {
                Swal.fire({
                    icon: 'error',
                    title: 'Access Denied',
                    text: 'You must be logged in as Admin to access this page.',
                    confirmButtonText: 'Login',
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = "/login.html";
                    }
                });
            }
        };

        $(document).ready(function () {
            const rowsPerPage = 10;
            let currentPage = 1;
            let tableData = [];

            function fetchData() {
                $.ajax({
                    url: "https://api.fundsweb.in/api/v1/user/subscription-summaries",
                    method: "GET",
                    success: function (response) {
                        if (response.success && Array.isArray(response.summaries)) {
                            const reversedSummaries = response.summaries.reverse();
                            // console.log("API Response:", reversedSummaries);

                            tableData = reversedSummaries.map((item, index) => {
                                const user = item.user || {};
                                const registrant = item.domainRegistrant || {};
                                const subscriptions = item.subscriptions || [];

                                const name = user.name || `${registrant.firstName || ""} ${registrant.lastName || ""}`.trim();
                                const email = user.email || registrant.email || "--";
                                const phone = user.phoneNumber || "--";
                                const city = registrant.city || "--";
                                const gst = user.gstNumber || "--";
                                const address = registrant.addressLine1 || "--";

                                let paymentStatus = '<span class="badge bg-soft-primary text-primary">Pending</span>';
                                let latestInvoiceDate = "--";

                                const validSub = subscriptions.find(sub => sub.subscriptionStatus === "1" || sub.subscriptionStatus === "2");
                                if (validSub) {
                                    if (validSub.subscriptionStatus === "1") {
                                        paymentStatus = '<span class="badge bg-soft-success text-success">Completed</span>';
                                        latestInvoiceDate = validSub.createdAt ? validSub.createdAt.split("T")[0] : "--";
                                    } else if (validSub.subscriptionStatus === "2") {
                                        paymentStatus = '<span class="badge bg-soft-primary text-primary">Pending</span>';
                                    }
                                }

                                return {
                                    sno: index + 1,
                                    name,
                                    email,
                                    phone,
                                    latestInvoiceDate,
                                    gst,
                                    address,
                                    city,
                                    paymentStatus
                                };
                            });

                            renderTable();
                            renderPagination();
                        } else {
                            console.error("Invalid response format.");
                        }
                    },
                    error: function (err) {
                        console.error("Error fetching data:", err);
                    }
                });
            }

            function renderTable() {
                const tbody = $("#leadsTable tbody");
                tbody.empty();
                const start = (currentPage - 1) * rowsPerPage;
                const end = start + rowsPerPage;
                const rows = tableData.slice(start, end);

                rows.forEach((row) => {
                    const tr = `<tr>
                    <td>${row.sno}</td>
                    <td>${row.name}</td>
                    <td>${row.phone}</td>
                    <td>${row.email}</td>
                    <td>${row.latestInvoiceDate}</td>
                    <td>${row.gst}</td>
                    <td>${row.address}</td>
                    <td>${row.city}</td>
                    <td>${row.paymentStatus}</td>
                </tr>`;
                    tbody.append(tr);
                });
            }

            function renderPagination() {
                const totalPages = Math.ceil(tableData.length / rowsPerPage);
                const pagination = $("#pagination");
                pagination.empty();

                const visiblePageCount = 3;
                let startPage = Math.max(currentPage - 1, 1);
                let endPage = startPage + visiblePageCount - 1;
                if (endPage > totalPages) {
                    endPage = totalPages;
                    startPage = Math.max(endPage - visiblePageCount + 1, 1);
                }

                const prevDisabled = currentPage === 1 ? 'disabled' : '';
                const nextDisabled = currentPage === totalPages ? 'disabled' : '';

                pagination.append(`<li><a href="javascript:void(0);" class="${prevDisabled}" onclick="changePage(${currentPage - 1})">&laquo;</a></li>`);

                for (let i = startPage; i <= endPage; i++) {
                    const active = i === currentPage ? "active" : "";
                    pagination.append(`<li><a href="javascript:void(0);" class="${active}" onclick="changePage(${i})">${i}</a></li>`);
                }

                pagination.append(`<li><a href="javascript:void(0);" class="${nextDisabled}" onclick="changePage(${currentPage + 1})">&raquo;</a></li>`);
            }

            window.changePage = function (page) {
                const totalPages = Math.ceil(tableData.length / rowsPerPage);
                if (page < 1 || page > totalPages) return;
                currentPage = page;
                renderTable();
                renderPagination();
            };

            window.filterTable = function () {
                const value = $("#searchInput").val().toLowerCase().trim();
                if (!value) {
                    renderTable();
                    renderPagination();
                    return;
                }

                const filtered = tableData.filter((row) =>
                    Object.values(row).some((field) => {
                        const plainText = $('<div>').html(field).text().toLowerCase().trim();
                        return plainText === value;
                    })
                );

                const tbody = $("#leadsTable tbody");
                tbody.empty();
                filtered.forEach((row, index) => {
                    const tr = `<tr>
                    <td>${index + 1}</td>
                    <td>${row.name}</td>
                    <td>${row.phone}</td>
                    <td>${row.email}</td>
                    <td>${row.latestInvoiceDate}</td>
                    <td>${row.gst}</td>
                    <td>${row.address}</td>
                    <td>${row.city}</td>
                    <td>${row.paymentStatus}</td>
                </tr>`;
                    tbody.append(tr);
                });

                $("#pagination").hide();
            };

            window.printTable = function () {
                const printWindow = window.open('', '', 'height=600,width=800');
                printWindow.document.write('<html><head><title>Print Table</title></head><body>');
                printWindow.document.write($("#leadsTable")[0].outerHTML);
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.print();
            };

            window.exportToExcel = function () {
                const headers = [
                    "S No.",
                    "Name",
                    "Mobile No.",
                    "Email",
                    "Date of Payment",
                    "GST No.",
                    "Address",
                    "City",
                    "Status of Payment"
                ];

                const data = [headers];

                tableData.forEach((row, index) => {
                    const clean = (html) => $('<div>').html(html).text().trim();
                    data.push([
                        index + 1,
                        row.name,
                        row.phone,
                        row.email,
                        row.latestInvoiceDate,
                        row.gst,
                        row.address,
                        row.city,
                        clean(row.paymentStatus)
                    ]);
                });

                const worksheet = XLSX.utils.aoa_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Onboarding");
                XLSX.writeFile(workbook, "OnboardingDetails_All.xlsx");
            };

            fetchData();
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const logoutLinks = [document.getElementById("logout-button")];

            function deleteCookie(name) {
                document.cookie = name + '=; Max-Age=0; path=/; domain=' + location.hostname;
            }
            function clearAllUserData() {
                console.warn('Clearing ALL localStorage, sessionStorage, and cookies...');
                localStorage.clear();
                sessionStorage.clear();
                deleteCookie('token');
                console.warn('All user data cleared.');
            }

            logoutLinks.forEach(link => {
                if (link) {
                    link.addEventListener("click", function (event) {
                        event.preventDefault(); // Prevent default link behavior

                        Swal.fire({
                            title: "Are you sure?",
                            text: "You will be logged out!",
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#05DAC3",
                            cancelButtonColor: "#d33",
                            confirmButtonText: "Yes, logout"
                        }).then((result) => {
                            if (result.isConfirmed) {
                                clearAllUserData();
                                console.log("User data cleared on logout.");

                                Swal.fire({
                                    title: "Logged out!",
                                    text: "You have been successfully logged out.",
                                    icon: "success",
                                    confirmButtonColor: "#05DAC3",
                                    showConfirmButton: false
                                });

                                setTimeout(() => {
                                    window.location.href = "/login.html";
                                }, 1600);
                            }
                        });
                    });
                }
            });
        });
    </script>

</body>

</html>